1 		 				 **********************************
2 		 				 *PROGRAMA DE EJEMPLO
3 		 				 **********************************
4 		 				 
5 1026	 				 PACTL  EQU   $1026
6 1027	 				 PACNT  EQU   $1027
7 1030	 				 ADCTL  EQU   $1030
8 1031	 				 ADR1   EQU   $1031
9 1032	 				 ADR2   EQU   $1032
10 1033	 				 ADR3   EQU   $1033
11 1034	 				 ADR4   EQU   $1034
12 1039	 				 OPTION EQU   $1039
13 		 				 
14 1000	 				 PORTA  EQU   $1000
15 1008	 				 PORTD  EQU   $1008
16 100A	 				 PORTE  EQU   $100A
17 1002	 				 PORTG  EQU   $1002
18 		 				 
19 1001	 				 DDRA   EQU   $1001
20 1009	 				 DDRD   EQU   $1009
21 1003	 				 DDRG   EQU   $1003
22 		 				    
23 1024	 				 TMSK2  EQU   $1024
24 1025	 				 TFLG2  EQU   $1025
25 		 				 
26 102F	 				 SCDR   EQU   $102F
27 102D	 				 SCCR2  EQU   $102D
28 102E	 				 SCSR   EQU   $102E
29 102C	 				 SCCR1  EQU   $102C
30 102B	 				 BAUD   EQU   $102B
31 103C	 				 HPRIO  EQU   $103C
32 1028	 				 SPCR   EQU   $1028
33 105D	 				 CSCTL  EQU   $105D
34 1038	 				 OPT2   EQU   $1038
35 		 				 
36 		 				 * VARIABLES *********************
37 		 				 
38 0C	 				 ORDEN  EQU   $000C
39 0D	 				 SEG    EQU   $000D
40 0E	 				 U1     EQU   $000E
41 0F	 				 U2     EQU   $000F
42 10	 				 U3     EQU   $0010
43 11	 				 U4     EQU   $0011
44 12	 				 U5     EQU   $0012
45 13	 				 V1     EQU   $0013
46 14	 				 V2     EQU   $0014
47 15	 				 BAS_H  EQU   $0015
48 16	 				 BAS_L  EQU   $0016
49 17	 				 V5     EQU   $0017
50 18	 				 TEMPO  EQU   $0018
51 19	 				 ALTO   EQU   $0019
52 1A	 				 BAJO   EQU   $001A
53 1B	 				 BASE_H EQU   $001B
54 1C	 				 BASE_L EQU   $001C
55 1D	 				 V3     EQU   $001D
56 1E	 				 V4     EQU   $001E
57 		 				 
58 		 				 **********************************
59 		 				 *CONFIGURA REGISTROS
60 		 				 **********************************
61 		8000 				        ORG   $8000   * DIR DE INICIO
62 8000 8E00ff 				        LDS   #$00FF  * APUNTADOR DE STAK
63 		 				 
64 		 				                
65 8003 8600 				        LDAA  #$00    * CONFIG TODO EL PUERTO  A COMO ENTRADAS
66 8005 B71001 				        STAA  DDRA    * EL PUERTO A
67 		 				        
68 8008 86ff 				        LDAA  #$FF    * CONFIG TODO EL PUERTO  G COMO SALIDAS
69 800A B71003 				        STAA  DDRG    * EL PUERTO G 
70 		 				 
71 800D 8600 				        LDAA  #$00    * SE PONE PUERTO G EN CEROS
72 800F B71002 				        STAA  PORTG
73 		 				        
74 8012 CC302c 				        LDD   #$302C  * CONFIGURA PUERTO SERIAL
75 8015 B7102B 				        STAA  BAUD    * BAUD  9600  para cristal de 8MHz
76 8018 F7102D 				        STAB  SCCR2   * HABILITA  RX Y TX PERO INTERRUPCN SOLO RX
77 801B 8600 				        LDAA  #$00
78 801D B7102C 				        STAA  SCCR1   * 8 BITS
79 		 				 
80 8020 86fe 				        LDAA  #$FE    * CONFIG PUERTO D COMO SALIDAS (EXCEPTO PD0)
81 8022 B71009 				        STAA  DDRD    * SEA  ENABLE DEL DISPLAY  PD4  Y RS PD3
82 		 				                      
83 		 				       
84 8025 8604 				        LDAA  #$04
85 8027 B7103C 				        STAA  HPRIO
86 		 				 
87 802A 8600 				        LDAA  #$00
88 802C 06   				        TAP
89 		 				 
90 		 				 
91 		 				 
92 		 				        
93 		 				 
94 		 				 
95 		 				 
96 		 				 **********************************
97 		 				 *PROGRAMA PRINCIPAL
98 		 				 **********************************
99 802D	 				 MAIN 
100 802D BD80D5 				        JSR    INICIA
101 		 				         
102 8030 7F0011 				 INICIO  CLR    U4
103 8033 7F0010 				 NO_S1   CLR    U3
104 8036 7F000F 				 NO_S    CLR    U2
105 8039 7F000E 				         CLR    U1 
106 		 				 
107 		 				  
108 		 				 
109 		 				 
110 803C	 				 OTRO    
111 803C 863F 				         LDAA    #'?
112 803E B7000C 				         STAA    ORDEN
113 		 				        
114 8041	 				 CICLO
115 8041 B6000C 				         LDAA    ORDEN
116 8044 813F 				         CMPA    #'?
117 8046 27F9 				         BEQ     CICLO
118 		 				 
119 8048 F6000E 				         LDAB    U1
120 804B 260A 				         BNE     CHECA_U2
121 804D 8173 				         CMPA    #'s
122 804F 26EB 				         BNE     OTRO
123 8051 B7000E 				         STAA    U1
124 8054 7E803C 				         JMP     OTRO
125 		 				 
126 		 				 
127 8057	 				 CHECA_U2
128 		 				 
129 8057 F6000F 				         LDAB    U2
130 805A 2614 				         BNE     CHECA_U3
131 805C 8174 				         CMPA    #'T
132 805E 270A 				         BEQ     ES_T
133 8060 8173 				         CMPA    #'S
134 8062 27D8 				         BEQ     OTRO
135 8064 7F000E 				         CLR     U1
136 8067 7E803C 				         JMP     OTRO
137 806A B7000F 				 ES_T    STAA    U2
138 806D 7E803C 				         JMP     OTRO
139 		 				 
140 8070	 				 CHECA_U3
141 		 				 
142 8070 F60010 				         LDAB    U3
143 8073 2614 				         BNE     CHECA_U4
144 8075 8161 				         CMPA    #'A
145 8077 270A 				         BEQ     ES_A
146 8079 8173 				         CMPA    #'S
147 807B 26B9 				         BNE     NO_S
148 807D 7F000F 				         CLR     U2
149 8080 7E803C 				         JMP     OTRO
150 		 				 
151 8083	 				 ES_A
152 		 				 
153 8083 B70010 				         STAA    U3
154 8086 7E803C 				         JMP     OTRO
155 		 				 
156 8089	 				 CHECA_U4
157 		 				 
158 8089 F60011 				         LDAB    U4
159 808C 2617 				         BNE     CHECA_T
160 808E 8172 				         CMPA    #'R
161 8090 270D 				         BEQ     ES_R
162 8092 8173 				         CMPA    #'S
163 8094 269D 				         BNE     NO_S1
164 8096 7F0010 				         CLR     U3
165 8099 7F000F 				         CLR     U2
166 809C 7E803C 				         JMP     OTRO
167 		 				 
168 809F	 				 ES_R
169 		 				 
170 809F B70011 				         STAA    U4
171 80A2 7E803C 				         JMP     OTRO
172 		 				  
173 80A5	 				 CHECA_T
174 		 				 
175 80A5 8174 				         CMPA    #'T
176 80A7 2710 				         BEQ     EXITO
177 80A9 8173 				         CMPA    #'S
178 80AB 2683 				         BNE     INICIO
179 80AD 7F0011 				         CLR     U4
180 80B0 7F0010 				         CLR     U3
181 80B3 7F000F 				         CLR     U2
182 80B6 7E803C 				         JMP     OTRO
183 		 				 
184 80B9	 				 EXITO
185 80B9 8665 				         LDAA  #'E
186 80BB B70019 				         STAA  ALTO
187 80BE 8678 				         LDAA  #'X
188 80C0 B7001A 				         STAA  BAJO
189 80C3 8669 				         LDAA  #'I
190 80C5 B7001B 				         STAA  BASE_H
191 80C8 8674 				         LDAA  #'T
192 80CA B7001C 				         STAA  BASE_L
193 80CD 866F 				         LDAA  #'O
194 80CF B7001D 				         STAA  V3
195 		 				 
196 80D2 7E802D 				         JMP MAIN       
197 		 				 
198 		 				 
199 		 				 ***********************************
200 		 				 * INICIA
201 		 				 ***********************************
202 80D5	 				 INICIA
203 		 				      
204 80D5 7F000D 				       CLR  SEG
205 		 				 
206 80D8 7F1002 				       CLR  PORTG
207 80DB 86f4 				       LDAA #$F4         
208 80DD B70018 				       STAA TEMPO         * TEMPO ES VARIABLE PARA CONTAR 244 CICLOS
209 		 				 
210 80E0 CE1024 				       LDX #TMSK2
211 ERROR 007 				       BSET $00,X,#$40    * HABILITA INTERRUPCION TIMER T-REAL
212 80E3 0E   				       CLI
213 		 				 
214 80E4 CE1026 				       LDX #PACTL
215 ERROR 007 				       BSET $00,X,#$50    * HABILITA PAEN -ACUMULADOR PULSOS ALTOS-
216 80E7 7F1027 				       CLR PACNT          * BORRA ACUMULADOR DE PULSOS
217 		 				 
218 80EA 8610 				       LDAA #$10
219 80EC B7001B 				       STAA BASE_H        * PONE UN #1060 COMO DIRECCION BASE INICIAL
220 80EF 8660 				       LDAA #$60
221 80F1 B7001C 				       STAA BASE_L    
222 		 				       
223 80F4 18CE1060 		       LDY  #$1060      
224 		 				       
225 80F8 8616 				       LDAA #$16
226 80FA B70015 				       STAA BAS_H        * PONE UN #1653 NUMERO TOTAL DE JUEGO DE MUESTRAS
227 80FD 8653 				       LDAA #$53
228 80FF B70016 				       STAA BAS_L   
229 		 				 
230 		 				 
231 8102 7F0019 				       CLR  ALTO          * INICIA INDICE MUESTRA EN 0
232 8105 7F001A 				       CLR  BAJO
233 		 				 
234 8108 39   				        RTS
235 		 				 ***********************************
236 		 				 * SACA
237 		 				 ***********************************
238 8109	 				 SACA
239 		 				             
240 		 				        
241 8109 B60019 				        LDAA  ALTO         * INDICE DE MUESTRA (SEGUNDO)
242 810C F6001A 				        LDAB  BAJO
243 810F 188F 				        XGDY
244 8111 1808 				        INY
245 8113 188F 				        XGDY
246 8115 BD8227 				        JSR   BINBCD
247 8118 BD8186 				        JSR   DISPLAY
248 ERROR 001/002/003 		        JSR   COMA
249 		 				  
250 811E B6001B 				        LDAA  BASE_H       * INDICE DE MUESTRA (PARTICULAR)
251 8121 F6001C 				        LDAB  BASE_L
252 8124 188F 				        XGDY
253 		 				        
254 8126 1808 				        INY
255 8128 4F   				        CLRA
256 8129 18E600 				        LDAB  $00,Y  
257 812C BD8236 				        JSR   BNBCD
258 812F BD819F 				        JSR   DSPLY
259 ERROR 001/002/003 		        JSR   COMA
260 		 				 
261 8135 1808 				        INY
262 8137 4F   				        CLRA
263 8138 18E600 				        LDAB  $00,Y
264 813B BD8236 				        JSR   BNBCD
265 813E BD819F 				        JSR   DSPLY
266 ERROR 001/002/003 		        JSR   COMA
267 		 				 
268 8144 1808 				        INY
269 8146 4F   				        CLRA
270 8147 18E600 				        LDAB  $00,Y
271 814A BD8236 				        JSR   BNBCD
272 814D BD819F 				        JSR   DSPLY
273 ERROR 001/002/003 		        JSR   COMA
274 		 				 
275 8153 1808 				        INY
276 8155 4F   				        CLRA
277 8156 18E600 				        LDAB  $00,Y
278 8159 BD8236 				        JSR   BNBCD
279 815C BD819F 				        JSR   DSPLY
280 ERROR 001/002/003 		        JSR   COMA
281 		 				  
282 8162 1808 				        INY
283 8164 4F   				        CLRA 
284 8165 18E600 				        LDAB  $00,Y
285 8168 BD8236 				        JSR   BNBCD
286 816B BD819F 				        JSR   DSPLY
287 		 				        
288 816E 188F 				        XGDY
289 8170 B7001B 				        STAA BASE_H
290 8173 F7001C 				        STAB BASE_L
291 		 				 
292 8176 BD81C4 				        JSR   CRYTRN
293 		 				 
294 8179 39   				        RTS
295 		 				 ***********************************
296 		 				 * COMA
297 		 				 ***********************************
298 ERROR 009 				 COMA
299 817A CE102E 				        LDX   #SCSR 
300 		 				        
301 817D B6102E 				        LDAA  SCSR
302 8180 862c 				        LDAA  #$2C             * COMA
303 8182 B7102F 				        STAA  SCDR
304 8185	 				 C1
305 ERROR 007 				        BRCLR $00,X,#$80 C1 
306 8185 39   				        RTS
307 		 				 ***********************************
308 		 				 * DESPLIEGA
309 		 				 ***********************************
310 8186	 				 DISPLAY
311 		 				        
312 8186 CE102E 				        LDX   #SCSR 
313 		 				        
314 8189 B6102E 				        LDAA  SCSR
315 818C B6000E 				        LDAA  U1             * U1
316 818F 8B30 				        ADDA  #$30
317 8191 B7102F 				        STAA  SCDR
318 8194	 				 T1
319 ERROR 007 				        BRCLR $00,X,#$80 T1 
320 		 				       
321 8194 B6102E 				        LDAA  SCSR
322 8197 B6000F 				        LDAA  U2             * U2
323 819A 8B30 				        ADDA  #$30
324 819C B7102F 				        STAA  SCDR
325 819F	 				 T2
326 ERROR 007 				        BRCLR $00,X,#$80 T2 
327 		 				 
328 819F	 				 DSPLY  
329 819F CE102E 				        LDX   #SCSR
330 		 				     
331 81A2 B6102E 				        LDAA SCSR
332 81A5 B60010 				        LDAA  U3             * U3
333 81A8 8B30 				        ADDA  #$30
334 81AA B7102F 				        STAA  SCDR
335 81AD	 				 T3
336 ERROR 007 				        BRCLR $00,X,#$80 T3 
337 		 				       
338 81AD B6102E 				        LDAA SCSR 
339 81B0 B60011 				        LDAA  U4             * U4
340 81B3 8B30 				        ADDA  #$30
341 81B5 B7102F 				        STAA  SCDR
342 81B8	 				 T4
343 ERROR 007 				        BRCLR $00,X,#$80 T4 
344 		 				    
345 81B8 B6102E 				        LDAA SCSR
346 81BB B60012 				        LDAA  U5             * U5
347 81BE 8B30 				        ADDA  #$30
348 81C0 B7102F 				        STAA  SCDR
349 81C3	 				 T5
350 ERROR 007 				        BRCLR $00,X,#$80 T5  
351 		 				        
352 81C3 39   				        RTS
353 		 				 
354 		 				 ***********************************
355 		 				 * CARRY RETURN
356 		 				 ***********************************
357 		 				 
358 81C4	 				 CRYTRN
359 81C4 CE102E 				        LDX   #SCSR 
360 81C7 B6102E 				        LDAA  SCSR
361 81CA 860a 				        LDAA  #$0A             * NEW LINE     
362 81CC B7102F 				        STAA  SCDR
363 81CF	 				 CR1
364 ERROR 007 				        BRCLR $00,X,#$80 CR1        
365 		 				 
366 81CF B6102E 				        LDAA SCSR
367 81D2 860d 				        LDAA #$0D              * CARRY RETURN     
368 81D4 B7102F 				        STAA SCDR
369 81D7	 				 CR2
370 ERROR 007 				        BRCLR $00,X,#$80 CR2        
371 		 				 
372 81D7 39   				        RTS
373 		 				 ***********************************
374 		 				 *  DESPLIEGUE DE DATO RECIBIDO
375 		 				 ***********************************
376 		 				 
377 81D8	 				 DATARX
378 81D8 CE102E 				        LDX   #SCSR 
379 81DB B6102E 				        LDAA  SCSR
380 81DE B6000C 				        LDAA  ORDEN             * NEW LINE     
381 81E1 B7102F 				        STAA  SCDR
382 81E4	 				 DT1
383 ERROR 007 				        BRCLR $00,X,#$80 DT1        
384 		 				 
385 81E4 B6102E 				        LDAA SCSR 
386 81E7 863a 				        LDAA #$3A              * DOS PUNTOS    
387 81E9 B7102F 				        STAA SCDR
388 81EC	 				 DT2
389 ERROR 007 				        BRCLR $00,X,#$80 DT2        
390 		 				 
391 81EC 39   				        RTS
392 		 				 ***********************************
393 		 				 * voltimetro
394 		 				 ***********************************
395 81ED	 				 VOLTA
396 81ED CE1030 				       LDX #ADCTL      
397 		 				 
398 81F0 8680 				       LDAA #$80
399 81F2 B71039 				       STAA OPTION        * PONE EN MARCHA EL ADC
400 		 				     
401 81F5 8610 				       LDAA #$10
402 81F7 B71030 				       STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 0
403 		 				 
404 81FA	 				 E1
405 ERROR 007 				       BRCLR $00,X,#$80 E1  
406 81FA F61031 				       LDAB ADR1
407 81FD F70013 				       STAB V1
408 		 				       
409 8200 8680 				       LDAA #$80
410 8202 B71039 				       STAA OPTION        * PONE EN MARCHA EL ADC
411 		 				     
412 8205 8611 				       LDAA #$11
413 8207 B71030 				       STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 1
414 		 				 
415 820A	 				 E2
416 ERROR 007 				       BRCLR $00,X,#$80 E2  
417 820A F61032 				       LDAB ADR2
418 820D F70014 				       STAB V2
419 		 				      
420 8210 8612 				       LDAA #$12
421 8212 B71030 				       STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 2
422 		 				 
423 8215	 				 E3
424 ERROR 007 				       BRCLR $00,X,#$80 E3  
425 8215 F61033 				       LDAB ADR3
426 8218 F7001D 				       STAB V3 
427 		 				 
428 821B 8613 				       LDAA #$13
429 821D B71030 				       STAA ADCTL         * ENTRADA MULTIPLE SELECCIONA CANAL 3
430 		 				 
431 8220	 				 E4
432 ERROR 007 				       BRCLR $00,X,#$80 E4  
433 8220 F61034 				       LDAB ADR4
434 8223 F7001E 				       STAB V4
435 		 				 
436 		 				            
437 8226 39   				       RTS
438 		 				 ***********************************
439 		 				 * CONVIERTE A BCD
440 		 				 ***********************************
441 		 				 
442 8227	 				 BINBCD
443 		 				      
444 8227 CE2710 				       LDX  #$2710
445 822A 02   				       IDIV 
446 822B 8F   				       XGDX
447 822C F7000E 				       STAB U1
448 822F 8F   				       XGDX
449 ERROR 007 				       LDX  #$3E8
450 8230 02   				       IDIV
451 8231 8F   				       XGDX
452 8232 F7000F 				       STAB U2
453 8235 8F   				       XGDX
454 		 				 
455 8236	 				 BNBCD
456 ERROR 007 				       LDX  #$64
457 8236 02   				       IDIV
458 8237 8F   				       XGDX
459 8238 F70010 				       STAB U3
460 823B 8F   				       XGDX
461 ERROR 007 				       LDX  #$A
462 823C 02   				       IDIV
463 823D 8F   				       XGDX
464 823E F70011 				       STAB U4
465 8241 8F   				       XGDX
466 8242 F70012 				       STAB U5
467 		 				 
468 		 				 
469 		 				 
470 8245 39   				       RTS
471 		 				 
472 		 				 
473 		 				 
474 		 				 ***********************************
475 		 				 * ATENCION A INTERRUPCION SERIAL
476 		 				 ***********************************
477 		F100 				        ORG  $F100
478 		 				   
479 F100 36   				        PSHA
480 		 				  
481 F101 B6102E 				        LDAA SCSR
482 F104 B6102F 				        LDAA SCDR
483 F107 B7000C 				        STAA ORDEN
484 		 				 
485 F10A 32   				        PULA  
486 		 				 
487 F10B 3B   				        RTI
488 		 				 
489 		 				 ***********************************
490 		 				 * ATENCION A INTERRUPCION REAL TIME
491 		 				 ***********************************
492 		F110 				       ORG  $F110
493 		 				 
494 F110 36   				       PSHA
495 F111 3C   				       PSHX
496 		 				 
497 F112 CE1025 				       LDX #TFLG2
498 ERROR 007 				       BSET $00,X,#$40    * BORRA BANDERA INTERRUPCION
499 F115 7A0018 				       DEC TEMPO
500 F118 2703 				       BEQ SEGUNDO
501 		 				       
502 F11A 32   				       PULA
503 F11B 38   				       PULX
504 F11C 3B   				       RTI
505 		 				 
506 F11D	 				 SEGUNDO
507 F11D 86ff 				       LDAA #$FF
508 F11F B7000D 				       STAA SEG           * SEG ES UNA BANDERA DE SEGUNDO    
509 F122 86f4 				       LDAA #$F4         
510 F124 B70018 				       STAA TEMPO         * TEMPO ES VARIABLE PARA CONTAR 244 CICLOS
511 F127 7C1002 				       INC  PORTG
512 		 				      
513 F12A 32   				       PULA
514 F12B 38   				       PULX
515 F12C 3B   				       RTI
516 		 				 ***********************************
517 		 				 * VECTOR INTERRUPCION SERIAL
518 		 				 ***********************************
519 		FFD6 				        ORG   $FFD6
520 ERROR 004 				        FCB   $F1,$00       
521 		 				 
522 		 				 ***********************************
523 		 				 * VECTOR INTERRUPCION REAL TIME
524 		 				 ***********************************
525 		FFF0 				        ORG   $FFF0
526 ERROR 004 				        FCB   $F1,$10       
527 		 				 
528 		 				 ***********************************
529 		 				 *RESET
530 		 				 ***********************************
531 		FFFE 				        ORG    $FFFE
532 ERROR 011 				 RESET  FCB    $80,$00
533 		 				 ***********************************
534 			 				        END   $8000


=== Descripcion de errores ===
001   CONSTANTE INEXISTENTE
002   VARIABLE INEXISTENTE
003   ETIQUETA INEXISTENTE
004   MNEMÓNICO INEXISTENTE
005   INSTRUCCIÓN CARECE DE  OPERANDO(S)
006   INSTRUCCIÓN NO LLEVA OPERANDO(S)
007   MAGNITUD DE  OPERANDO ERRONEA
008   SALTO RELATIVO MUY LEJANO
009   INSTRUCCIÓN CARECE DE ALMENOS UN ESPACIO RELATIVO AL MARGEN
010   NO SE ENCUENTRA END
011   SINTAXIS INCORRECTA
012   INSTRUCCIÓN CON EXCESO DE OPERANDO(S)